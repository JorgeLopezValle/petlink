<th:block th:fragment="content">
    <div class="grid gap-6 md:grid-cols-2 xl:grid-cols-3" id="mascotasContainer">
        <div th:each="mascota : ${mascotas}"
             th:object="${mascota}"
             th:attr="data-nombre=*{nombre},data-raza=*{raza},data-especie=*{especie},data-edad=*{edad}"
            class="mascota-card bg-white rounded-xl shadow-md hover:shadow-2xl transition-all duration-300 overflow-hidden transform hover:-translate-y-2">

            <a th:href="@{'/mascota/detalle/' + *{id}}" class="block">
                <div class="relative h-64 overflow-hidden">
                <img th:if="*{imagenUrl != null and !imagenUrl.isEmpty()}" th:src="*{imagenUrl}"
                    th:alt="*{nombre}" class="w-full h-full object-cover"
                    onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">

                <div th:if="*{imagenUrl == null or imagenUrl.isEmpty()}"
                    class="w-full h-full bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 flex items-center justify-center">
                    <svg class="w-32 h-32 text-white/30" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M4.41003 16.75C4.17003 19.64 6.35003 22 9.25003 22H14.04C17.3 22 19.54 19.37 19 16.15C18.43 12.77 15.17 10 11.74 10C8.02003 10 4.72003 13.04 4.41003 16.75Z"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M10.47 7.5C11.8507 7.5 12.97 6.38071 12.97 5C12.97 3.61929 11.8507 2.5 10.47 2.5C9.08926 2.5 7.96997 3.61929 7.96997 5C7.96997 6.38071 9.08926 7.5 10.47 7.5Z"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>

                <div style="display: none;"
                    class="w-full h-full bg-gradient-to-br from-blue-400 via-purple-500 to-pink-500 items-center justify-center">
                    <svg class="w-32 h-32 text-white/30" viewBox="0 0 24 24" fill="none">
                        <path
                            d="M4.41003 16.75C4.17003 19.64 6.35003 22 9.25003 22H14.04C17.3 22 19.54 19.37 19 16.15C18.43 12.77 15.17 10 11.74 10C8.02003 10 4.72003 13.04 4.41003 16.75Z"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                        <path
                            d="M10.47 7.5C11.8507 7.5 12.97 6.38071 12.97 5C12.97 3.61929 11.8507 2.5 10.47 2.5C9.08926 2.5 7.96997 3.61929 7.96997 5C7.96997 6.38071 9.08926 7.5 10.47 7.5Z"
                            stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
                    </svg>
                </div>

                <div class="absolute top-3 right-3">
                    <span th:if="*{adoptada}"
                        class="px-3 py-1.5 text-xs font-bold text-gray-700 bg-gray-200 rounded-full shadow-lg backdrop-blur-sm">
                        ❤️ Adoptada
                    </span>
                    <span th:unless="*{adoptada}"
                        class="px-3 py-1.5 text-xs font-bold text-green-700 bg-green-100 rounded-full shadow-lg backdrop-blur-sm">
                        ✨ Disponible
                    </span>
                </div>
            </div>

            <div class="p-5">
                <h3 class="text-2xl font-bold text-gray-900 mb-3 text-center" th:text="*{nombre}">Nombre</h3>

                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="text-center p-3 bg-blue-50 rounded-lg">
                        <p class="text-xs text-blue-600 font-semibold uppercase">Raza</p>
                        <p class="text-sm font-bold text-gray-900 truncate" th:text="*{raza}">Labrador</p>
                    </div>
                    <div class="text-center p-3 bg-purple-50 rounded-lg">
                        <p class="text-xs text-purple-600 font-semibold uppercase">Especie</p>
                        <p class="text-sm font-bold text-gray-900" th:text="*{especie}">Perro</p>
                    </div>
                    <div class="text-center p-3 bg-orange-50 rounded-lg">
                        <p class="text-xs text-orange-600 font-semibold uppercase">Edad</p>
                        <p class="text-sm font-bold text-gray-900" th:text="*{edad} + ' años'">2 años</p>
                    </div>
                    <div class="text-center p-3 bg-green-50 rounded-lg">
                        <p class="text-xs text-green-600 font-semibold uppercase">Peso</p>
                        <p class="text-sm font-bold text-gray-900" th:text="${(mascota.peso % 1 == 0 ? #numbers.formatInteger(mascota.peso, 1) : #numbers.formatDecimal(mascota.peso, 1, 2)) + ' kg'}">15 kg</p>
                    </div>
                </div>

                <p class="text-sm text-gray-600 text-center mb-4 line-clamp-2" th:text="*{descripcion}">
                    Descripción de la mascota...
                </p>

                <div class="flex items-center justify-between pt-4 border-t border-gray-200">
                    <div class="text-xs text-gray-500">
                        <p class="font-semibold text-gray-900" th:text="*{protectora.nombre}">Protectora</p>
                        <p th:text="*{protectora.ciudad.nombre}">Ciudad</p>
                    </div>
                    <div th:if="*{adoptada}"
                        class="px-3 py-1.5 text-xs font-semibold text-gray-500 bg-gray-100 rounded-lg">
                        Adoptada
                    </div>
                </div>
            </div>
            </a>

            <div th:if="${!mascota.adoptada}" class="px-5 pb-5">
                <form th:action="@{'/mascota/adoptar/' + ${mascota.id}}" method="post"
                      class="form-adopcion" th:attr="data-tipo-entidad=${session.tipoEntidad},data-rol=${session.rol}"
                      onclick="event.stopPropagation()">
                    <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
                    <button type="submit"
                        class="w-full px-4 py-2 text-sm font-bold text-white bg-gradient-to-r from-pink-500 to-rose-500 rounded-lg hover:from-pink-600 hover:to-rose-600 transition-all duration-200 hover:scale-105">
                        Adoptar
                    </button>
                </form>
            </div>
        </div>
    </div>

    <div id="modalAdopcion" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6 transform transition-all">
            <div id="modalIconContainer" class="flex items-center justify-center mb-4">
                <div id="modalIcon" class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center">
                    <svg id="iconError" class="w-8 h-8 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
                    </svg>
                    <svg id="iconConfirm" class="w-8 h-8 text-pink-600 hidden" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                </div>
            </div>
            <h3 id="modalTitulo" class="text-xl font-bold text-gray-900 text-center mb-3">No puedes adoptar</h3>
            <p id="modalMensaje" class="text-gray-600 text-center mb-6">
                No tienes permisos para adoptar mascotas.
            </p>
            <div class="flex gap-3">
                <button id="btnCancelar" onclick="cerrarModalAdopcion()"
                    class="flex-1 px-4 py-2 bg-gray-200 text-gray-700 font-semibold rounded-lg hover:bg-gray-300 transition-all duration-200 hidden">
                    Cancelar
                </button>
                <button id="btnEntendido" onclick="cerrarModalAdopcion()"
                    class="w-full px-4 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white font-semibold rounded-lg hover:from-pink-600 hover:to-rose-600 transition-all duration-200">
                    Entendido
                </button>
                <button id="btnConfirmar" onclick="confirmarAdopcion()"
                    class="flex-1 px-4 py-2 bg-gradient-to-r from-pink-500 to-rose-500 text-white font-semibold rounded-lg hover:from-pink-600 hover:to-rose-600 transition-all duration-200 hidden">
                    Sí, adoptar
                </button>
            </div>
        </div>
    </div>

    <script th:src="@{/js/modal-adopcion.js}"></script>
</th:block>
